<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/stylesheets/style.css">
    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/2.1.8/js/dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">

    <!--<script src="app.js"></script>-->
    <script src="/javascripts/region.js"></script>
    <script src="/javascripts/statistics.js"></script>
    <script src="javascripts/region.js"></script>
    <script src="javascripts/estacion.js"></script>
    <script src="javascripts/contaminante.js"></script>

    <!-- Cargar Chart.js y math.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.4.3/math.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.0.0/math.min.js"></script>

    <script src="/javascripts/main.js"></script>
    <title>WebGIS con Barra de Tareas y Puntos Personalizados</title>

</head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estadísticas de Contaminación</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<body>
    <div id="loading-spinner" style="display: none;">Loading...</div>
    <!-- Contenedor principal -->
    <div class="main-container">
        <div class="container-fluid vh-100 d-flex">
            <!-- Barra de Tareas a la Izquierda -->
            <nav id="sidebar" class="col-md-2 bg-success text-light p-4" style="width: 25%;">
                <h4>Menú de Funciones</h4>
                <ul class="nav flex-column">
                    <!-- Menú de Gestión de Regiones -->
                        <li class="nav-item mb-3 dropdown">
                            <button class="dropbtn nav-link text-light" id="gestionRegiones">Gestión de Regiones</button>
                            <div class="dropdown-content">
                                <!-- Opción "Agregar Región" -->
                                <button class="sub-dropbtn" data-bs-toggle="modal" data-bs-target="#modalAgregarRegion">Agregar Región</button>

                                <!-- Opción "Editar Región" -->
                                <button class="sub-dropbtn" data-bs-toggle="modal" data-bs-target="#modalEditarRegion">Editar Región</button>

                                <!-- Opción "Eliminar Región" -->
                                <button class="sub-dropbtn" data-bs-toggle="modal" data-bs-target="#modalEliminarRegion">Eliminar Región</button>
                            </div>
                        </li>

                        <!-- Modal "Agregar Región" -->
                        <div class="modal fade" id="modalAgregarRegion" tabindex="-1" aria-labelledby="agregarRegionLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content text-black">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="agregarRegionLabel">Agregar Región</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="mb-3">
                                            <label for="idRegion" class="form-label">ID de la Región</label>
                                            <input type="text" class="form-control" id="idRegion" placeholder="Ejemplo: 6">
                                        </div>
                                        <div class="mb-3">
                                            <label for="nombre" class="form-label">Nombre de la Región</label>
                                            <input type="text" class="form-control" id="nombre" placeholder="Ejemplo: Peaje Sajonia">
                                        </div>
                                        <div class="mb-3">
                                            <label for="descripcion" class="form-label">Descripción</label>
                                            <textarea class="form-control" id="descripcion" rows="3" placeholder="Ejemplo: Región cerca al peaje"></textarea>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                        <button type="button" class="btn btn-primary" id="btnGuardarRegion">Guardar</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Modal "Editar Región" -->
                        <div class="modal fade" id="modalEditarRegion" tabindex="-1" aria-labelledby="editarRegionLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content text-black">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="editarRegionLabel">Editar Región</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="mb-3">
                                            <label for="selectRegion" class="form-label">Seleccionar Región</label>
                                            <select class="form-select" id="selectRegion">
                                                <!-- Opciones dinámicas cargadas desde la base de datos -->
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="editarNombre" class="form-label">Nuevo Nombre</label>
                                            <input type="text" class="form-control" id="editarNombre" placeholder="Nuevo nombre">
                                        </div>
                                        <div class="mb-3">
                                            <label for="editarDescripcion" class="form-label">Nueva Descripción</label>
                                            <textarea class="form-control" id="editarDescripcion" rows="3" placeholder="Nueva descripción"></textarea>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                        <button type="button" class="btn btn-primary" id="btnGuardarCambios">Guardar Cambios</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Modal "Eliminar Región" -->
                        <div class="modal fade" id="modalEliminarRegion" tabindex="-1" aria-labelledby="eliminarRegionLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content text-black">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="eliminarRegionLabel">Eliminar Región</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="mb-3">
                                            <label for="selectEliminarRegion" class="form-label">Seleccionar Región(es)</label>
                                            <select id="selectEliminarRegion" class="form-select" multiple>
                                                <!-- Opciones dinámicas cargadas desde la base de datos -->
                                            </select>
                                            <small class="form-text text-muted">Mantén presionada Ctrl (o Cmd en Mac) para seleccionar varias regiones.</small>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                        <button type="button" class="btn btn-danger" id="btnEliminarRegiones">Eliminar Seleccionadas</button>
                                    </div>
                                </div>
                            </div>
                        </div>


                    <!-- Asegúrate de tener incluido Bootstrap CSS y JS en tu proyecto -->

                    <!-- Menú de Gestión de Estaciones -->
                    <li class="nav-item mb-3 dropdown">
                        <button class="dropbtn nav-link text-light" id="gestionEstaciones">Gestión de Estaciones</button>
                        <div class="dropdown-content">
                            <!-- Opción "Agregar Estación" -->
                            <button class="sub-dropbtn" data-bs-toggle="modal" data-bs-target="#modalAgregarEstacion">Agregar Estación</button>

                            <!-- Opción "Editar Estación" -->
                            <button class="sub-dropbtn" data-bs-toggle="modal" data-bs-target="#modalEditarEstacion">Editar Estación</button>

                            <!-- Opción "Eliminar Estación" -->
                            <button class="sub-dropbtn" data-bs-toggle="modal" data-bs-target="#modalEliminarEstacion">Eliminar Estación</button>
                        </div>
                    </li>

                    <!-- Modal "Agregar Estación" -->
                    <div class="modal fade" id="modalAgregarEstacion" tabindex="-1" aria-labelledby="agregarEstacionLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content text-black">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="agregarEstacionLabel">Agregar Estación</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label for="nombreEstacion" class="form-label">Nombre</label>
                                        <input type="text" class="form-control" id="nombreEstacion">
                                    </div>
                                    <div class="mb-3">
                                        <label for="descripcionEstacion" class="form-label">Descripción</label>
                                        <input type="text" class="form-control" id="descripcionEstacion">
                                    </div>
                                    <div class="mb-3">
                                        <label for="latitudEstacion" class="form-label">Latitud</label>
                                        <input type="text" class="form-control" id="latitudEstacion">
                                    </div>
                                    <div class="mb-3">
                                        <label for="longitudEstacion" class="form-label">Longitud</label>
                                        <input type="text" class="form-control" id="longitudEstacion">
                                    </div>
                                    <div class="mb-3">
                                        <label for="regionEstacion" class="form-label">Región</label>
                                        <select id="regionEstacion" class="form-select">
                                            <!-- Las opciones serán cargadas dinámicamente -->
                                        </select>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="button" class="btn btn-primary" id="btnGuardarEstacion">Guardar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal "Editar Estación" -->
                    <div class="modal fade" id="modalEditarEstacion" tabindex="-1" aria-labelledby="editarEstacionLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content text-black">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editarEstacionLabel">Editar Estación</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label for="selectEstacion" class="form-label">Seleccionar Estación</label>
                                        <select class="form-select" id="selectEstacion">
                                            <!-- Opciones dinámicas cargadas desde la base de datos -->
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="editarNombreEstacion" class="form-label">Nuevo Nombre</label>
                                        <input type="text" class="form-control" id="editarNombreEstacion" placeholder="Nuevo nombre">
                                    </div>
                                    <div class="mb-3">
                                        <label for="editarDescripcionEstacion" class="form-label">Nueva Descripción</label>
                                        <textarea class="form-control" id="editarDescripcionEstacion" rows="3" placeholder="Nueva descripción"></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="editarLatitudEstacion" class="form-label">Nueva Latitud</label>
                                        <input type="text" class="form-control" id="editarLatitudEstacion" placeholder="Nueva latitud">
                                    </div>
                                    <div class="mb-3">
                                        <label for="editarLongitudEstacion" class="form-label">Nueva Longitud</label>
                                        <input type="text" class="form-control" id="editarLongitudEstacion" placeholder="Nueva longitud">
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="button" class="btn btn-primary" id="btnGuardarCambiosEstacion">Guardar Cambios</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal "Eliminar Estación" -->
                    <div class="modal fade" id="modalEliminarEstacion" tabindex="-1" aria-labelledby="eliminarEstacionLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content text-black">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="eliminarEstacionLabel">Eliminar Estación</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="formEliminarEstaciones">
                                        <!-- Opciones dinámicas cargadas desde la base de datos -->
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="button" class="btn btn-danger" id="btnEliminarEstaciones">Eliminar Seleccionadas</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Menú de Gestión de Contaminantes -->
                    <li class="nav-item mb-3 dropdown">
                        <button class="dropbtn nav-link text-light" id="gestionContaminantes">Gestión de Contaminantes</button>
                        <div class="dropdown-content">
                            <!-- Opción "Agregar Contaminante" -->
                            <button class="sub-dropbtn" data-bs-toggle="modal" data-bs-target="#modalAgregarContaminante">Agregar Contaminante</button>

                            <!-- Opción "Editar Contaminante" -->
                            <button class="sub-dropbtn" data-bs-toggle="modal" data-bs-target="#modalEditarContaminante">Editar Contaminante</button>

                            <!-- Opción "Eliminar Contaminante" -->
                            <button class="sub-dropbtn" data-bs-toggle="modal" data-bs-target="#modalEliminarContaminante">Eliminar Contaminante</button>
                        </div>
                    </li>

                    <!-- Modal "Agregar Contaminante" -->
                    <div class="modal fade" id="modalAgregarContaminante" tabindex="-1" aria-labelledby="agregarContaminanteLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content text-black">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="agregarContaminanteLabel">Agregar Contaminante</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="formAgregarContaminante">
                                        <div class="mb-3">
                                            <label for="nombreContaminante" class="form-label">Nombre</label>
                                            <input type="text" class="form-control" id="nombreContaminante" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="descripcionContaminante" class="form-label">Descripción</label>
                                            <textarea class="form-control" id="descripcionContaminante" rows="3" required></textarea>
                                        </div>
                                        <button type="button" id="btnGuardarContaminante" class="btn btn-primary">Guardar</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal "Editar Contaminante" -->
                    <div class="modal fade" id="modalEditarContaminante" tabindex="-1" aria-labelledby="editarContaminanteLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content text-black">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editarContaminanteLabel">Editar Contaminante</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="formEditarContaminante">
                                        <div class="mb-3">
                                            <label for="selectContaminante" class="form-label">Contaminante</label>
                                            <select class="form-select" id="selectContaminante" required>
                                                <option value="">Seleccione un contaminante</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="editarNombreContaminante" class="form-label">Nombre</label>
                                            <input type="text" class="form-control" id="editarNombreContaminante" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="editarDescripcionContaminante" class="form-label">Descripción</label>
                                            <textarea class="form-control" id="editarDescripcionContaminante" rows="3" required></textarea>
                                        </div>
                                        <button type="button" id="btnGuardarCambiosContaminante" class="btn btn-primary">Guardar cambios</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal "Eliminar Contaminante" -->
                    <div class="modal fade" id="modalEliminarContaminante" tabindex="-1" aria-labelledby="eliminarContaminanteLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content text-black">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="eliminarContaminanteLabel">Eliminar Contaminante</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="formEliminarContaminante">
                                        <div class="mb-3">
                                            <label for="selectEliminarContaminante" class="form-label">Seleccione un contaminante</label>
                                            <select class="form-select" id="selectEliminarContaminante" required>
                                                <option value="">Seleccione un contaminante</option>
                                            </select>
                                        </div>
                                    </form>
                                    <button type="button" id="btnEliminarContaminante" class="btn btn-danger">Eliminar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Menú de Consultas y Gráficos -->
                    <!-- <li class="nav-item mb-3 dropdown">
                        <button class="dropbtn nav-link text-light" id="btnConsultasGraficos">Consultas y Gráficos</button>
                        <div class="dropdown-content">
                            <button class="sub-dropbtn" data-bs-toggle="modal" data-bs-target="#modalAnalisisDatosConsultas">Análisis de Datos</button>
                        </div>
                    </li>

                    <!-- Modal "Análisis de Datos" -->
                    <!-- <div class="modal fade" id="modalAnalisisDatosConsultas" tabindex="-1" aria-labelledby="analisisDatosLabel" aria-hidden="true">
                        <form id="analisis-form">
                            <div class="modal-dialog">
                                <div class="modal-content text-black">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="analisisDatosLabel">Análisis de Datos</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="mb-3">
                                            <label for="fechaInicio" class="form-label">Fecha Inicio</label>
                                            <input type="date" class="form-control" id="fechaInicio" value="2024-01-01">
                                            <label for="fechaFin" class="form-label mt-2">Fecha Fin</label>
                                            <input type="date" class="form-control" id="fechaFin" value="2024-12-31">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Estación</label>
                                            <div class="row" id="estacionesContainer"></div>
                                            <input type="hidden" id="selectedEstacion">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Contaminante</label><br>
                                            <div id="contaminante-checkboxes"></div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="selectEstadisticas" class="form-label">Estadísticas y Gráficos</label>
                                            <select id="selectEstadisticas" class="form-select">
                                                <option value="promedio">Promedio</option>
                                                <option value="desviacion">Desviación Estándar</option>
                                                <option value="maximo">Máximo</option>
                                                <option value="minimo">Mínimo</option>
                                                <option value="mediana">Mediana</option>
                                                <option value="rango">Rango</option>
                                                <option value="cuartiles">Cuartiles</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                        <button id="generar-analisis" type="submit" class="btn btn-primary">Generar Análisis</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Resultado del análisis -->
                    <!-- <div id="resultado-analisis" class="mt-4"></div>

                    <!-- Menú de Exportación de Datos -->
                    <!-- <li class="nav-item mb-3 dropdown">
                        <button class="dropbtn nav-link text-light" id="exportacionDatos">Exportación de Datos</button>
                        <div class="dropdown-content">
                            <button class="sub-dropbtn" data-bs-toggle="modal" data-bs-target="#modalExportacionDatos">Exportar Datos</button>
                        </div>
                    </li>

                    <!-- Modal "Exportación de Datos" -->
                    <!-- <div class="modal fade" id="modalExportacionDatos" tabindex="-1" aria-labelledby="exportacionDatosLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content text-black">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exportacionDatosLabel">Exportación de Datos</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form>
                                        <div class="mb-3">
                                            <label for="tipoExportacion" class="form-label">Seleccionar formato de exportación</label>
                                            <select class="form-select" id="tipoExportacion">
                                                <option value="CSV">CSV</option>
                                                <option value="JSON">JSON</option>
                                                <option value="SHAPE">SHAPE</option>
                                            </select>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="button" class="btn btn-primary">Exportar</button>
                                </div>
                            </div>
                        </div>
                    </div> -->


                </ul>
            </nav>

            <!-- Contenedor del mapa -->
            <div id="mapContainer" class="col-md-10" style="width: 75%;">
                <div id="map"></div>
            </div>
        </div>
        <div class="task-container">

            <!-- Barra de Tareas con filtros, tabla y gráficos -->
            <div id="task-bar-container">
                <div id="filters">
                    <label for="estacion">Estación:</label>
                    <select id="estacion" multiple>
                        <option value="1">Via Industrial Occidental</option>
                        <option value="2">Portal Occidental</option>
                        <option value="3">Portal Oriental</option>
                        <option value="4">Casa Verde</option>
                        <option value="5">Peaje Sajonia</option>
                    </select>
                    
                    <label for="contaminante">Contaminante:</label>
                    <select id="contaminante">
                        <option value="1">PM10</option>
                        <option value="2">PM2.5</option>
                        <option value="3">SO2</option>
                    </select>

                    <label for="fecha-inicio">Fecha Inicio:</label>
                    <input type="date" id="fecha-inicio">

                    <label for="fecha-fin">Fecha Fin:</label>
                    <input type="date" id="fecha-fin">

                    <button id="apply-filters">Aplicar Filtros</button>
                </div>

                <!-- Contenedor de la tabla -->
                <div id="table-container">
                    <table id="results-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los datos filtrados dinámicamente se inyectarán aquí -->
                        </tbody>
                    </table>
                </div>

                <!-- Contenedor del gráfico -->
                <div id="chart-panel">
                    <canvas id="chart" width="800" height="400"></canvas>
                </div>

                <!-- Estadísticas -->
                <div id="stats-container">
                    <h3>Estadísticas:</h3>
                    <ul>
                        <li>Promedio: <span id="average"></span></li>
                        <li>Desviación Estándar: <span id="std-dev"></span></li>
                        <li>Máximo: <span id="max"></span></li>
                        <li>Mínimo: <span id="min"></span></li>
                        <li>Mediana: <span id="median"></span></li>
                        <li>Rango: <span id="range"></span></li>
                        <li>Cuartil 1: <span id="q1"></span></li>
                        <li>Cuartil 3: <span id="q3"></span></li>
                    </ul>
                </div>
            </div>

<script src="javascripts/data-filter.js"></script>

    <!-- Inicialización del mapa -->
    <script>
        var filtros = {};
        // Crear el mapa centrado en Medellín con la nueva capa base
        var Stadia_StamenTerrainBackground = L.tileLayer('https://tiles.stadiamaps.com/tiles/stamen_terrain_background/{z}/{x}/{y}{r}.{ext}', {
            minZoom: 0,
            maxZoom: 18,
            attribution: '&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            ext: 'png'
        });

        // Inicializar el mapa centrado en Medellín y agregar la nueva capa base
        var map = L.map('map', {
            center: [6.268658, -75.565801],  // Coordenadas de Medellín
            zoom: 12,                        // Nivel de zoom
            layers: [Stadia_StamenTerrainBackground]  // Nueva capa base
        });

        // Lista de puntos a agregar
        getGeoPoints().then((puntos) => {
            console.log(puntos);
            if (puntos && puntos.length > 0) {
                puntos.forEach((punto) => {
                    console.log(`ID: ${punto.id}, Lat: ${punto.latitud}, Lon: ${punto.longitud}`);
                    var marker = L.marker([punto.latitud, punto.longitud]).addTo(map);

                    // Bind a tooltip that will show on hover
                    marker.bindTooltip(punto.nombre, { permanent: false, direction: 'top' });

                    // Show tooltip on mouseover
                    marker.on('mouseover', function (e) {
                        marker.openTooltip();
                    });

                    // Hide tooltip on mouseout
                    marker.on('mouseout', function (e) {
                        marker.closeTooltip();
                    });
                });
            } else {
                console.log('No se encontraron puntos.');
            }
        });

        
        // Inicialización del DataTable
        $(document).ready(function () {
            $('#results-table').DataTable();
        });

        // Inicialización del gráfico
        //var ctx = document.getElementById('result-chart').getContext('2d');
        /*var chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo'], // Ejemplo de etiquetas
            datasets: [{
                label: 'Datos de Contaminantes',
                data: [12, 19, 3, 5, 2], // Ejemplo de datos
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
            }]
        },
        options: {}
        });*/

        // Inicialización del gráfico
        async function renderChart(filtros) {
            const ctx = document.getElementById('result-chart').getContext('2d');

            // Llamada al endpoint para obtener las estadísticas
            const data = await getStatistics(filtros);

            if (!data || data.length === 0) {
                console.log("No se encontraron datos para el gráfico.");
                return;
            }

            // Procesamiento de los datos para Chart.js
            const labels = data.map(item => item.estacion); // Etiquetas, ejemplo: nombres de las estaciones
            const datasetValues = data.map(item => item.promedio); // Datos, ejemplo: valores promedio

            // Configuración del gráfico dinámico
            const chart = new Chart(ctx, {
                type: 'line', // Cambiar a 'bar', 'pie', etc., según el tipo de gráfico deseado
                data: {
                    labels: labels, // Etiquetas en el eje X
                    datasets: [{
                        label: 'Promedio de Contaminación por Estación',
                        data: datasetValues, // Valores en el eje Y
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.4 // Hace la línea curva; cámbialo a 0 para líneas rectas
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            enabled: true
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Estaciones'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Promedio de Contaminación'
                            }
                        }
                    }
                }
            });
        }


        async function getGeoPoints() {
            const apiUrl = 'http://localhost:3000/api/geopoints';

            try {
                const response = await fetch(apiUrl);

                if (!response.ok) {
                    throw new Error(`Error en la solicitud: ${response.statusText}`);
                }

                const puntos = await response.json();
                // Add markers to map with hover tooltips

                return puntos;
            } catch (error) {
                console.error('Error al obtener los usuarios:', error);
            }
        }

       
    </script>
</body>

</html>